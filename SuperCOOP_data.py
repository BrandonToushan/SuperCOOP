#PACKAGE IMPORTS
import qexpy as e
import math as m
import matplotlib.pyplot as plt
import numpy as np

#EXPERIMENTAL SETUP/CONDITIONS
room_temp_celsius = e.Measurement(23.1,0.01)
reference_resistor_ohms = e.Measurement(537,10)
temp_resistance_ohms = e.Measurement(0.0205,0.0001) # at 77K
temp_resistance_ohms = e.Measurement(0.0207,0.0001) # at 4K

#EXPERIMENTAL RESULTS (RUN 1)

#VOLTAGE INPUTS
input_AC_mV_1 = e.MeasurementArray([990.5],[0.0001])
input_offset_DC_V_1 = e.MeasurementArray([1.981,1.881,1.781,1.681,1.581,1.481,1.381,1.281,1.181,1.081,0.981,0.881,0.781,0.681,0.581,0.481,0.381,0.281,0.181,0.081,-0.0190,-0.119,-0.219,-0.319,-0.419,-0.519,-0.619,-0.719,-0.819,-0.919,-1.019,-1.119,-1.219,-1.319,-1.419,-1.519,-1.619,-1.719,-1.819,-1.919,],[0.0001])

#OUTPUTS
output_AC_mV_1 = e.MeasurementArray([-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,-0.21,],[0.05])
output_offset_DC_mV_1 = e.MeasurementArray([0.0209,0.0234,0.0216,0.0213,0.0235,0.0237,0.0215,0.0211,0.0207,0.0268,0.0246,0.0220,0.0217,0.0237,0.0209,0.0208,0.0209,0.0194,0.0206,0.0216,0.0200,0.0189,0.0167,0.0187,0.0184,0.0170,0.0176,0.0177,0.0136,0.0145,0.0153,0.0160,0.0211,0.0206,0.0196,0.0216,0.0224,0.0235,0.0217,0.0185],[0.001])

#PLOTTING (RUN 1)
a_1 = input_offset_DC_V_1*1000
b_1 = output_offset_DC_mV_1
fig1 = e.MakePlot(a_1,b_1)
fig1.show()

#EXPERIMETAL RESULTS (RUN 2)

#VOLTAGE INPUTS
input_AC_mV_2 = e.MeasurementArray([990.5],[0.0001])
input_offset_DC_V_2 = e.MeasurementArray([1.981,1.881,1.781,1.681,1.581,1.481,1.381,1.281,1.181,1.081,0.981,0.881,0.781,0.681,0.581,0.481,0.381,0.281,0.181,0.081,-0.0190,-0.119,-0.219,-0.319,-0.419,-0.519,-0.619,-0.719,-0.819,-0.919,-1.019,-1.119,-1.219,-1.319,-1.419,-1.519,-1.619,-1.719,-1.819,-1.919,],[0.0001])

#OUTPUTS
output_AC_mV_2 = e.MeasurementArray([-0.21],[0.05])
output_offset_DC_mV_2 = e.MeasurementArray([0.0306,0.0246,0.0234,0.0238,0.0237,0.0176,0.0136,0.0123,0.0116,0.0218,0.0186,0.0214,0.0211,0.0179,0.0320,0.0352,0.0318,0.0349,0.0280,0.0308,0.0336,0.0343,0.0282,0.0346,0.0320,0.0314,0.0277,0.0325,0.0231,0.0242,0.0278,0.0350,0.0373,0.0347,0.0354,0.0307,0.0253,0.0227,0.0189,0.0124],[0.001])

#PLOTTING (RUN 2)
a_2 = input_offset_DC_V_2*1000
b_2= output_offset_DC_mV_2
fig2 = e.MakePlot(a_2,b_2)
fig2.show()

#EXPERIMETAL RESULTS (RUN 2)

#VOLTAGE INPUTS
input_AC_mV_3 = e.MeasurementArray([990.5],[0.0001])
input_offset_DC_V_3 = e.MeasurementArray([1.981,1.881,1.781,1.681,1.581,1.481,1.381,1.281,1.181,1.081,0.981,0.881,0.781,0.681,0.581,0.481,0.381,0.281,0.181,0.081,-0.0190,-0.119,-0.219,-0.319,-0.419,-0.519,-0.619,-0.719,-0.819,-0.919,-1.019,-1.119,-1.219,-1.319,-1.419,-1.519,-1.619,-1.719,-1.819,-1.919,],[0.0001])

#OUTPUTS
output_AC_mV_3 = e.MeasurementArray([-0.21],[0.05])
output_offset_DC_mV_3 = e.MeasurementArray([0.0198,0.0190,0.0183,0.0181,0.0180,0.0187,0.0185,0.0186,0.0194,0.0193,0.0195,0.0198,0.0197,0.0201,0.0193,0.0198,0.0203,0.0199,0.0208,0.0209,0.0210,0.0207,0.0209,0.0213,0.0202,0.0200,0.0209,0.0205,0.0217,0.0220,0.0217,0.0220,0.0223,0.0220,0.0215,0.0211,0.0226,0.0231,0.0220,0.0212],[0.001])

#PLOTTING (RUN 2)
a_3 = input_offset_DC_V_3*1000
b_3= output_offset_DC_mV_3
fig3 = e.MakePlot(a_3,b_3)
fig3.show()

#EXPERIMENTAL RESULTS (RUN 4) DONE WITH CORRECTIONS

# CONTACT RESISTANCE MEASUREMENT
resitance_4_ohms = e.Measurement(12.0238,0.01)

#VOLTAGE INPUTS
input_AC_mV_4 = e.MeasurementArray([25],[0.005])
input_offset_DC_mV_4 = e.MeasurementArray([-100,-90,-80,-70,-60,-50,-40,-35,-30,-25,-20,-19,-18,-17,-16,-15,-14,-13,-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,18,19,20,25,30,35,40,50,60,70,80,90,100,90,80,70,60,50,40,35,30,25,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-9,-10,-11,-12,-13,-14,-15,-16,-17,-18,-19,-20,-25,-30,-35,-40,-45,-50,-60,-70,-80,-90,-100],[0.5])

#OUTPUTS
output_AC_mV_4 = e.MeasurementArray([-0.21],[0.005])
output_offset_DC_mV_4 = e.MeasurementArray([0.0261,0.0237,0.0200,0.0154,0.0107,0.0065,0.0022,-0.0008,-0.0045,-0.0062,-0.0096,-0.0107,-0.0108,-0.0105,-0.0115,-0.0112,-0.0123,-0.0122,-0.0136,-0.0136,-0.0144,-0.0153,-0.0146,-0.0145,-0.0145,-0.0155,-0.0164,-0.0168,-0.0174,-0.0179,-0.0175,-0.0188,-0.0185,-0.0192,-0.0196,-0.0206,-0.0200,-0.0210,-0.0215,-0.0224,-0.0208,-0.0210,-0.0229,-0.0238,-0.0246,-0.0239,-0.0239,-0.0239,-0.0244,-0.0241,-0.0247,-0.0278,-0.0320,-0.0344,-0.0369,-0.0418,-0.0457,-0.0508,-0.0553,-0.0613,-0.0663,-0.0592,-0.0550,-0.0502,-0.0452,-0.0406,-0.0366,-0.0330,-0.0303,-0.0288,-0.0256,-0.0246,-0.0250,-0.0239,-0.0245,-0.0235,-0.0229,-0.0217,-0.0221,-0.0204,-0.0215,-0.0191,-0.0196,-0.0181,-0.0187,-0.0180,-0.0180,-0.0170,-0.0167,-0.0167,-0.0163,-0.0147,-0.0155,-0.0147,-0.0135,-0.0139,-0.0128,-0.0123,-0.0113,-0.0115,-0.0111,-0.0110,-0.0108,-0.0107,-0.0106,-0.0098,-0.0085,-0.0074,-0.0078,-0.0071,-0.0070,-0.0037,-0.0007,0.0001,0.0028,0.0088,0.0113,0.0135,0.0181,0.0227,0.0276,0.0314],[0.0005])

#PLOTTNG V_input vs V_offset
a_4 = input_offset_DC_mV_4
b_4= output_offset_DC_mV_4
fig4 = e.MakePlot(a_4,b_4)
fig4.fit('linear')
fig4.show()

#MAKING DIFFERENTIAL CURVE, NEEDS FIXING

#FINDING CURRENTS USING V = IR

# CONTACT RESISTANCE MEASUREMENT
resitance_4_ohms = 12.0238

current_conversion = 1/resitance_4_ohms

#CONVERTING MEASUREMENT ARRAYS

#INPUTS
input_AC_mV_a = np.array([25])
input_offset_DC_mV_a = np.array([-100,-90,-80,-70,-60,-50,-40,-35,-30,-25,-20,-19,-18,-17,-16,-15,-14,-13,-12,-11,-10,-9,-8,-7,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,18,19,20,25,30,35,40,50,60,70,80,90,100,90,80,70,60,50,40,35,30,25,20,19,18,17,16,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,-1,-2,-3,-4,-5,-6,-7,-8,-9,-10,-11,-12,-13,-14,-15,-16,-17,-18,-19,-20,-25,-30,-35,-40,-45,-50,-60,-70,-80,-90,-100])

#OUTPUTS
output_AC_mV_a = np.array([-0.21])
output_offset_DC_mV_a = np.array([0.0261,0.0237,0.0200,0.0154,0.0107,0.0065,0.0022,-0.0008,-0.0045,-0.0062,-0.0096,-0.0107,-0.0108,-0.0105,-0.0115,-0.0112,-0.0123,-0.0122,-0.0136,-0.0136,-0.0144,-0.0153,-0.0146,-0.0145,-0.0145,-0.0155,-0.0164,-0.0168,-0.0174,-0.0179,-0.0175,-0.0188,-0.0185,-0.0192,-0.0196,-0.0206,-0.0200,-0.0210,-0.0215,-0.0224,-0.0208,-0.0210,-0.0229,-0.0238,-0.0246,-0.0239,-0.0239,-0.0239,-0.0244,-0.0241,-0.0247,-0.0278,-0.0320,-0.0344,-0.0369,-0.0418,-0.0457,-0.0508,-0.0553,-0.0613,-0.0663,-0.0592,-0.0550,-0.0502,-0.0452,-0.0406,-0.0366,-0.0330,-0.0303,-0.0288,-0.0256,-0.0246,-0.0250,-0.0239,-0.0245,-0.0235,-0.0229,-0.0217,-0.0221,-0.0204,-0.0215,-0.0191,-0.0196,-0.0181,-0.0187,-0.0180,-0.0180,-0.0170,-0.0167,-0.0167,-0.0163,-0.0147,-0.0155,-0.0147,-0.0135,-0.0139,-0.0128,-0.0123,-0.0113,-0.0115,-0.0111,-0.0110,-0.0108,-0.0107,-0.0106,-0.0098,-0.0085,-0.0074,-0.0078,-0.0071,-0.0070,-0.0037,-0.0007,0.0001,0.0028,0.0088,0.0113,0.0135,0.0181,0.0227,0.0276,0.0314])

#TRIMMING LISTS

#VOLTAGE 

#FIRST HALF OF DATA
a = input_offset_DC_mV_a[0:60]
b = output_offset_DC_mV_a[0:60]
b_x1 = output_offset_DC_mV_a[1:61]
diff_output_first_mV = b - b_x1
f = np.array(diff_output_first_mV)

#SECOND HALF OF DATA
c = input_offset_DC_mV_a[59:]
d = output_offset_DC_mV_a[59:]
d_x1 = output_offset_DC_mV_a[58:-1]
diff_output_second_mV = d - d_x1
g = np.array(diff_output_second_mV)

#CURRENT 
currenta = current_conversion*output_offset_DC_mV_a

#FIRST HALF OF THE DATA
e = currenta[0:60]
e_x1 = currenta[1:61]
diff_current = e - e_x1
h = np.array(diff_current)

#SECOND HALF OF THE DATA
z = currenta[58:-1]
z_x1 = currenta[58:-1]
diff_currenta = z - z_x1
i = np.array(diff_currenta)

#COMBINING LISTS

#PLOTTING FIRST HALF OF THE DATA
fig5 = plt.scatter(diff_output_first_mV,h)
plt.show()

#PLOTTING FIRST HALF OF THE DATA
fig6 = plt.scatter(diff_output_second_mV,i)
plt.show()

#EXPERIMENTAL RESULTS (RUN 5) DONE WITH EVEN MORE CORRECTIONS AND FRESHLY ETCHED TIP, WEEK 11 MONDAY

#RESISITANCE MEASUREMENT
resistance_5_ohms = e.MeasurementArray([5],[1])

#VOLTAGE INPUTS
input_AC_mV_5 = e.MeasurementArray([280.5],[0.05])
input_offset_DC_V_5 = e.MeasurementArray([3.37,3.30,3.25,3.20,3.15,3.10,3.05,3.00,2.95,2.90,2.85,2.80,2.75,2.70,2.65,2.60,2.55,2.50,2.45,2.40,2.35,2.30,2.25,2.20,2.15,2.10,2.05,2.00,1.95,1.90,1.85,1.80,1.75,1.70,1.65,1.60,1.55,1.50,1.45,1.40,1.35,1.30,1.25,1.20,1.15,1.10,1.05,1.00,0.95,0.90,0.85,0.80,0.75,0.70,0.65,0.60,0.55,0.50,0.45,0.40,0.35,0.30,0.25,0.20,0.15,0.10,0.05,-0.05,-0.10,-0.15,-0.20,-0.25,-0.30,-0.35,-0.40,-0.45,-0.50,-0.55,-0.60,-0.65,-0.70,-0.75,-0.80,-0.85,-0.90,-0.95,-1,-1.05,-1.10,-1.15,-1.20,-1.25,-1.30,-1.35,-1.40,-1.45,-1.50,-1.60,-1.70,-1.80,-1.90,-2,-2.1,-2.2,-2.3,-2.4,-2.5,-2.6,-2.7,-2.8,-2.9,-3],[0.005])

#VOLTAGE OUTPUTS
output_AC_uV_5 = e.MeasurementArray([71.76,72.28,73.28,74.01,74.06,74.95,75.38,81.70,80.50,83.50,84.15,84.00,84.68,85.95,85.55,87.63,88.42,89.41,90.20,91.49,92.25,92.85,93.84,92.72,92.42,92.16,92.25,91.23,90.00,87.01,84.80,83.33,80.88,77.33,73.30,69.69,66.00,63.58,60.38,56.84,54.31,52.15,49.88,45.80,43.76,42.30,40.90,39.83,38.25,38.16,36.41,35.86,34.38,34.61,33.31,32.48,32.50,32.26,31.98,31.65,31.78,31.64,31.40,31.75,31.50,31.81,31.51,31.46,35.68,35.54,35.96,36.49,41.60,43.85,47.50,51.66,54.32,57.28,64.47,67.62,75.02,79.65,86.05,98.88,102.69,111.67,120.57,129.01,134.80,146.17,157.62,163.38,167.09,170.78,179.55,182.10,181.32,177.42,175.56,175.63,177.47,179.77,182.46,185.22,188.90,191.47,194.10,194.91,194.68,193.55,190.70,187.99],[2])
output_offset_DC_mV_5 = e.MeasurementArray([0.8801,0.8579,0.8353,0.8130,0.8037,0.7780,0.7567,0.8584,0.8311,0.8239,0.8008,0.7794,0.7429,0.7209,0.7331,0.7020,0.6797,0.6575,0.6344,0.6176,0.5919,0.5651,0.5391,0.5202,0.5038,0.4771,0.4567,0.4358,0.4215,0.4007,0.3753,0.3574,0.3336,0.3127,0.2947,0.2803,0.2625,0.2445,0.2266,0.2124,0.1982,0.1879,0.1838,0.1702,0.1547,0.1369,0.1289,0.1236,0.1083,0.1029,0.0934,0.0834,0.0757,0.0687,0.0600,0.0500,0.0421,0.0323,0.0280,0.0163,0.0086,0.0020,-0.0053,-0.0119,-0.0196,-0.0274,-0.0364,-0.0433,-0.0487,-0.0586,-0.0674,-0.0714,-0.0994,-0.1101,-0.1239,-0.1431,-0.1552,-0.1664,-0.1963,-0.2081,-0.2272,-0.2496,-0.2834,-0.3087,-0.3289,-0.3609,-0.3906,-0.4295,-0.4511,-0.5055,-0.5472,-0.5672,-0.6195,-0.6593,-0.6937,-0.7240,-0.7927,-0.8651,-0.9600,-1.0570,-1.1496,-1.2287,-1.3140,-1.4117,-1.4999,-1.6094,-1.7071,-1.8065,-1.9016,-1.9972,-2.0945,-2.1903],[0.001])

#CHECKING LISTS
#a = len(input_offset_DC_V_5)
#b = len(output_AC_uV_5)
#c = len(output_offset_DC_mV_5)

#PLOTTNG V_AC_output vs V_DC_input

a_5 = -1*output_offset_DC_mV_5
b_5 = output_AC_uV_5
fig7 = e.MakePlot(a_5,b_5)
fig7.show()

#EXPERIMENTAL RESULTS (RUN 6) DONE WITH EVEN MORE CORRECTIONS AND FRESHLY ETCHED TIP, WEEK 11 WEDNESDAY

#TRIAL FAILED DUE TO BROKEN/OXIDIZIED NIOBIUM CONTACT

#RUN 6 RE-TRIED WEEK 11 THURSDAY

#RESISTANCE MEASUREMENT
resistance_6_ohms = e.MeasurementArray([30],[3])

#VOLTAGE INPUTS
input_AC_mv_6 = e.MeasurementArray([280.5],[0.05])
input_offset_DC_V_6 = e.MeasurementArray([-3.30,-3.23,-3.16,-3.09,-3.02,-2.95,-2.88,-2.81,-2.74,-2.67,-2.60,-2.53,-2.46,-2.39,-2.32,-2.25,-2.18,-2.11,-2.04,-1.97,-1.90,-1.83,-1.76,-1.69,-1.62,-1.55,-1.48,-1.41,-1.34,-1.27,-1.20,-1.13,-1.06,-0.99,-0.92,-0.85,-0.78,-0.71,-0.64,-0.57,-0.50,-0.43,-0.36,-0.29,-0.22,-0.15,-0.08,0,0.08,0.16,0.24,0.30,0.40,0.48,0.56,0.64,0.72,-0.80,-0.88,-0.96,1.04,1.12,1.20,1.28,1.36,1.44,1.52,1.60,1.68,1.76,1.84,1.92,1.98,2.08,2.16,2.24,2.32,2.40,2.48,2.56,2.64,2.72,2.80,2.88,2.96,3.04,3.12,3.20,3.30],[0.005])

#VOLTAGE OUTPUTS
output_offset_DC_mV_6 = e.MeasurementArray([5.8974,5.7416,5.6362,5.5902,5.4831,5.3880,5.2571,5.1265,5.0315,4.9134,4.7666,4.6703,4.5696,4.4358,4.3043,4.1719,4.0441,4.0446,3.8585,3.7929,3.6727,3.5576,3.4249,3.2859,3.1508,2.9999,2.8572,2.7526,2.6349,2.5087,2.4134,2.2651,2.1118,2.0035,1.8835,1.7191,1.5858,1.4427,1.3032,1.1879,1.1051,0.8796,0.7286,0.5969,0.4518,0.2975,0.1543,0.0024,-0.1719,-0.3365,-0.5180,-0.6667,-0.8777,-1.0607,-1.2799,-1.4472,-1.6468,-1.8292,-2.0531,-2.2588,-2.4778,-2.6747,-2.8713,-3.0914,-3.3159,-3.5260,-3.7327,-3.9784,-4.1721,-4.3933,-4.5787,-4.7240,-4.9671,-5.2432,-5.4360,-5.6835,-5.9012,-6.1380,-6.3294,-6.5568,-6.7338,-6.9114,-7.1135,-7.3352,-7.5002,-7.8032,-8.0179,-8.1675,-8.5134],[0.001])
output_AC_uV_6 = e.MeasurementArray([368.8,368.8,371.8,375.5,377.7,380.1,379.5,380.3,382.5,383.0,385.0,387.1,389.9,391.2,391.5,394.0,396.2,400.4,404.6,408.5,412.4,413.2,415.6,416.0,417.1,416.4,418.5,425.6,430.1,437.2,437.8,434.4,436.1,440.2,444.0,440.8,438.6,435.1,430.7,429.1,428.6,421.5,417.9,415.5,413.3,413.3,415.8,408.9,427.1,427.7,433.6,436.9,447.3,456.7,462.8,471.7,476.1,487.3,488.7,494.4,496.3,505.7,507.0,511.4,514.9,515.2,516.6,514.8,516.3,517.0,516.6,517.1,517.9,519.9,518.8,520.0,520.5,519.5,519.5,519.5,520.3,517.1,517.4,516.2,518.7,519.8,518.5,518.0,518.8],[2])

#CHECK LISTS
#a = len(input_offset_DC_V_6)
#b = len(output_AC_uV_6)
#c = len(output_offset_DC_mV_6)

#PLOTTING
a_6 = -1*output_offset_DC_mV_6
b_6 = 1/output_AC_uV_6
fig8 = e.MakePlot(a_6,b_6)
fig8.show()

